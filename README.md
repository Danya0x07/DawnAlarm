# DawnAlarm
прошивка для минималистичного, но многофункционального будильника-рассвета-часов-светомузыки-rgb_лампы.

<img src="./image1.jpg" width="400">
<img src="./image2.jpg" width="400">

### Компоненты
- микроконтроллер STM8S103F3P6;
- Часы реального времени DS1307;
- Микросхема EEPROM памяти AT24C32;
- Четырёхразрядный семисегментный индикатор на микросхеме TM1637;
- Светодиодная RGB-лента;
- Кнопка и потенциометр.
******************************************************************
### Возможности
- Питается по USB от телефонной зарядки (должна обеспечивать ток не меньше 1A);
- Световой будильник с настраиваемой длительностью рассвета (5 - 20 минут);
- Настройки будильника сохраняются в энергонезависимую память;
- RGB-лампа с возможностью установки яркости каждого цвета (0 - 255);
- Режим дискотеки;
- Автоматическая подстройка яркости дисплея относительно текущего времени,
состояния RGB-ленты и действий пользователя (вечером тускнеет, а днём,
либо если RGB-лента включена, либо когда пользователь входит в меню - светлеет.
********************************************************************************
### Как пользоваться
Двойное нажатие - вход в меню устройства; (Если на кнопку нажимать слишком слабо,
она может не заметить.)

Пункты меню (отображаются на дисплее, меняются поворотом ручки потенциометра,
выбираются однократным нажатием на кнопку):
1. ALAr - настройка будильника;
2.  COL - управление RGB-лампой;
3. dICO - режим дискотеки;
4. CLOC - настройка текущего времени;
5. OEHA - отмена, выход из меню.
********************************************************************************
Настройка числовых значений производится поворотом ручки потенциометра
и однократным нажатием на кнопку.
******************************************************************************************
При настройке будильника сначала настраивается время срабатывания (ЧЧ:ММ),
затем длительность рассвета (ddXX), где dd означает dawn duration,
а 5 <= XX <= 20 минут. Это означает, что за XX минут до установленного времени будильника
RGB-лента плавно начнёт включаться, набирая яркость и переходя из красного в жёлтый,
затем в белый, и ко времени будильника наберёт полную яркость. Вследствие погрешности
целочисленного деления, при некоторых настройках полная яркость RGB-ленты набирается
не ровно в установленное время, а минутой раньше/позже. Однако это не заметно и особой
роли не играет.
******************************************************************************************
Выключение RGB-ленты производится однократным нажатием на кнопку, в независимости от того,
каким образом она была включена (будильник | ручная настройка RGB-лампы).
Выход из режима дискотеки производится также однократным нажатием на кнопку.
******************************************************************************************
Вне меню, т.е. в "обычном" состоянии двоеточие на дисплее мигает раз в секунду.
Иногда бывает так, что было двойное нажатие, но на дисплее по прежнему отображается
текущее время вместо пункта меню, при этом двоеточие перестаёт мигать. В этом случае надо
просто повернуть ручку, и дисплей обновится и будет показывать то, что должен.
В режиме дискотеки на дисплее отображается смайлик; лучше не смотреть долго на
переливающуюся RGB-ленту, т.к. яркий свет может утомить глаза).
******************************************************************************************
Когда устройство выключено, часы реального времени питаются от собственной батарейки CR2032
и когда-нибудь её нужно будет заменить. Для этого надо открутить 2 винта внизу корпуса и
извлечь внутреннюю часть (корпус сделан из выдвижного ящика - косметички, винты фиксируют ящик).
Далее аккуратно извлечь батарейку из держателя и вставить новую, не нажимая сильно
на края платы часов (она висит навесом над основной платой).
